Sub ImportUndTransformiereDaten()
    Dim wsZiel As Worksheet
    Dim wsQuell As Worksheet
    Dim wbQuell As Workbook
    Dim quellDatei As String
    Dim letzteZeileQuelle As Long, letzteZeileZiel As Long
    Dim dict As Object
    Dim i As Long

    ' Zielarbeitsblatt definieren
    Set wsZiel = ThisWorkbook.Worksheets("Rohdaten")

    ' Alte Daten in "Rohdaten" löschen ab Zeile 2
    wsZiel.Rows("2:" & wsZiel.Rows.Count).ClearContents

    ' Quelle Datei wählen
    quellDatei = Application.GetOpenFilename("Excel-Dateien (*.xls*), *.xls*", , "Wähle die Leaptree_Data Datei")
    If quellDatei = "False" Then Exit Sub ' Abbruch, wenn keine Datei gewählt wurde

    ' Quelle Datei öffnen
    Set wbQuell = Workbooks.Open(quellDatei)
    Set wsQuell = wbQuell.Worksheets(1) ' Angenommen, die Daten sind im ersten Arbeitsblatt

    ' Letzte Zeile in der Quelle ermitteln
    letzteZeileQuelle = wsQuell.Cells(wsQuell.Rows.Count, 2).End(xlUp).Row

    ' Dictionary initialisieren (zum Gruppieren von Daten)
    Set dict = CreateObject("Scripting.Dictionary")

    ' Daten aus der Quelle durchlaufen
    For i = 2 To letzteZeileQuelle
        Dim vorgangsnummer As String
        Dim frage As String
        Dim antwort As String
        Dim andereDaten As Variant

        vorgangsnummer = wsQuell.Cells(i, 2).Value ' Spalte B
        frage = wsQuell.Cells(i, 10).Value ' Spalte J
        antwort = wsQuell.Cells(i, 11).Value ' Spalte K
        andereDaten = wsQuell.Rows(i).Value ' Ganze Zeile

        If Not dict.exists(vorgangsnummer) Then
            dict.Add vorgangsnummer, CreateObject("Scripting.Dictionary")
            dict(vorgangsnummer)("Basisdaten") = andereDaten
        End If

        With dict(vorgangsnummer)
            .Add "Frage" & (.Count - 1), frage
            .Add "Antwort" & (.Count - 1), antwort
        End With
    Next i

    ' Daten ins Zielblatt schreiben
    Dim key As Variant
    Dim colIndex As Long
    Dim basisdaten As Variant
    letzteZeileZiel = 1

    For Each key In dict.keys
        letzteZeileZiel = letzteZeileZiel + 1
        basisdaten = dict(key)("Basisdaten")
        
        ' Basisdaten schreiben
        For colIndex = 1 To UBound(basisdaten, 2)
            wsZiel.Cells(letzteZeileZiel, colIndex).Value = basisdaten(1, colIndex)
        Next colIndex

        ' Fragen und Antworten anhängen
        colIndex = UBound(basisdaten, 2) + 1
        Dim innerKey As Variant
        For Each innerKey In dict(key).keys
            If innerKey <> "Basisdaten" Then
                wsZiel.Cells(letzteZeileZiel, colIndex).Value = dict(key)(innerKey)
                colIndex = colIndex + 1
            End If
        Next innerKey
    Next key

    ' Quellarbeitsmappe schließen
    wbQuell.Close SaveChanges:=False

    MsgBox "Import und Transformation abgeschlossen!", vbInformation
End Sub
