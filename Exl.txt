Sub FilterUndKopiere()
    Dim wb As Workbook
    Dim wsSource As Worksheet
    Dim wsDest As Worksheet
    Dim filterValue As String
    Dim lastRow As Long
    
    ' Öffne die SF-Datei im gleichen Ordner wie die aktuelle Arbeitsmappe
    Set wb = Workbooks.Open(ThisWorkbook.Path & "\SF.xlsx")
    
    ' Definiere die Quell- und Zielarbeitsblätter
    Set wsSource = wb.Sheets(1) ' Annahme: Die Daten befinden sich im ersten Arbeitsblatt der geöffneten Datei
    Set wsDest = ThisWorkbook.Sheets("Zuweisung_Level")
    
    ' Setze den Filterwert
    filterValue = "Lidl"
    
    ' Filtere die Daten nach Spalte D
    With wsSource
        ' Finde die letzte Zeile in Spalte D
        lastRow = .Cells(.Rows.Count, "D").End(xlUp).Row
        
        ' Filter anwenden
        .Range("D1:D" & lastRow).AutoFilter Field:=1, Criteria1:=filterValue
        
        ' Überprüfe, ob gefilterte Daten vorhanden sind
        If .AutoFilter.Range.Columns(1).SpecialCells(xlCellTypeVisible).Count > 1 Then
            ' Kopiere Spalte A in das Zielarbeitsblatt
            .AutoFilter.Range.Columns(1).Offset(, -3).SpecialCells(xlCellTypeVisible).Copy wsDest.Range("A1")
        Else
            MsgBox "Keine Daten gefunden für ""Lidl"" in Spalte D.", vbInformation
        End If
        
        ' Filter entfernen
        .AutoFilterMode = False
    End With
    
    ' Schließe die SF-Datei ohne zu speichern
    wb.Close False
    
    ' Meldung über erfolgreiche Durchführung anzeigen
    MsgBox "Die Daten wurden erfolgreich gefiltert und kopiert.", vbInformation
End Sub
